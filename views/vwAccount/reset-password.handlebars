{{#fillContent 'css'}}
<style>
  .auth-container {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .auth-card {
    max-width: 450px;
    width: 100%;
  }
</style>
{{/fillContent}}

<div class="container auth-container">
  <div class="auth-card">
    <div class="card shadow">
      <div class="card-body p-4">
        <div class="text-center mb-4">
          <i class="bi bi-shield-lock-fill text-primary" style="font-size: 3rem;"></i>
          <h3 class="mt-3">Reset Password</h3>
          <p class="text-muted">Enter your reset token and new password.</p>
        </div>

        {{#if error}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{error}}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {{/if}}

        {{#if errorMessages}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <strong>Please fix the following errors:</strong>
          <ul class="mb-0 mt-2">
            {{#each errorMessages}}
              <li>{{this.[0]}}</li>
            {{/each}}
          </ul>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {{/if}}

        <form method="post" action="/account/reset-password">
          <div class="mb-3">
            <label for="email" class="form-label">Email Address</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-envelope"></i>
              </span>
              <input 
                type="email" 
                class="form-control" 
                id="email" 
                name="email" 
                value="{{oldData.email}}"
                placeholder="your@email.com"
                required
              >
            </div>
          </div>

          <div class="mb-3">
            <label for="token" class="form-label">Reset Token</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-key"></i>
              </span>
              <input 
                type="text" 
                class="form-control text-uppercase" 
                id="token" 
                name="token" 
                value="{{oldData.token}}"
                placeholder="ABCD1234"
                required
                style="letter-spacing: 2px;"
              >
            </div>
            <small class="form-text text-muted">
              Enter the token from your email
            </small>
          </div>

          <hr class="my-4">

          <div class="mb-3">
            <label for="password" class="form-label">New Password</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-lock"></i>
              </span>
              <input 
                type="password" 
                class="form-control" 
                id="password" 
                name="password" 
                placeholder="At least 6 characters"
                required
                minlength="6"
              >
            </div>
          </div>

          <div class="mb-4">
            <label for="confirm_password" class="form-label">Confirm New Password</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-lock-fill"></i>
              </span>
              <input 
                type="password" 
                class="form-control" 
                id="confirm_password" 
                name="confirm_password" 
                placeholder="Re-enter password"
                required
                minlength="6"
              >
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100 mb-3">
            <i class="bi bi-check-circle-fill me-2"></i>Reset Password
          </button>

          <div class="text-center">
            <a href="/account/signin" class="text-decoration-none">
              <i class="bi bi-arrow-left me-1"></i>Back to Sign In
            </a>
          </div>
        </form>
      </div>
    </div>

    <div class="text-center mt-3">
      <small class="text-muted">
        Token expired? 
        <a href="/account/forgot-password" class="text-decoration-none">Request a new one</a>
      </small>
    </div>
  </div>
</div>

{{#fillContent 'js'}}
<script>
// Auto-uppercase token input
document.getElementById('token').addEventListener('input', function(e) {
  this.value = this.value.toUpperCase();
});

// Password match validation
document.querySelector('form').addEventListener('submit', function(e) {
  const pwd = document.getElementById('password').value;
  const confirm = document.getElementById('confirm_password').value;
  
  if (pwd !== confirm) {
    e.preventDefault();
    alert('Passwords do not match!');
    document.getElementById('confirm_password').focus();
  }
});
</script>
{{/fillContent}}
